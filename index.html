<!DOCTYPE html>
<html>
    
<canvas id="gameCanvas" width="1000" height="600"></canvas>
    
    <script>        
        var canvas;
        var canvasContext;
        var canvasWidth = document.getElementById('gameCanvas').width;
        var canvasHeight = document.getElementById('gameCanvas').height;
        var ballPosX = 50;
        var ballPosY = 50;
        var ballSize = canvasWidth/200;
        var ballDirX = 10;
        var ballDirY = 10;
        var seperatorHeight = document.getElementById('gameCanvas').height/10;
        const paddleWidth = canvasWidth/60;
        const paddleHeight = canvasHeight/4.5;
        var paddle1PosY = 0; 
        var paddle2PosY = 0;
        var scoreLeft = 0;
        var scoreRight = 0;
        var running = true;
        var fps = 60;
        
        
        window.onload = function() {
            canvas = document.getElementById('gameCanvas');
            canvasContext = canvas.getContext('2d');
            
            if(running){
                setInterval(function() {
                    moveBall();
                    movePaddle2();
                    drawEverything(); 
                }, 1000/fps);
            }
            
            canvas.addEventListener('mousemove',
                                   function(evt) {
                                        var mousePos = calculateMousePos(evt);
                                        paddle1PosY = mousePos.y - paddleHeight/2;
            });
            canvas.addEventListener('click',
                                   function(evt) {
                                        running = !running;
            });
        }
        
        function movePaddle2() {
            if(ballPosY < paddle2PosY){
                paddle2PosY -= canvasHeight/(fps+(fps/3));
                
                console.log(paddle2PosY);
            }else if(ballPosY > paddle2PosY + (paddleHeight/2)) {
                paddle2PosY += canvasHeight/70;
            }
        }
        
        function ballReset() {
            ballPosX = canvas.width/2;
            ballPosY = canvas.height/2;
        }
        
        function calculateMousePos(evt) {
            var rect = canvas.getBoundingClientRect();
            var root = document.documentElement;
            var mouseX = evt.clientX - rect.left - root.scrollLeft;
            var mouseY = evt.clientY - rect.top - root.scrollTop;
            return {
                x:mouseX,
                y:mouseY
            }; 
        }
        
        function drawEverything() {
            canvasContext.fillStyle = 'black';
            canvasContext.fillRect(0,0,canvas.width,canvas.height);
            
            canvasContext.fillStyle = 'white';
            for (i = 0; i < seperatorHeight; i++){
                canvasContext.fillRect(canvas.width/2, i*seperatorHeight+seperatorHeight/4, 1, seperatorHeight/2);
            }
            canvasContext.fillText(scoreLeft, 20, 20, 20);
            canvasContext.fillRect(0, paddle1PosY, paddleWidth, paddleHeight);
            canvasContext.fillRect(canvas.width-paddleWidth, paddle2PosY, paddleWidth, paddleHeight);
            
            canvasContext.beginPath();
            canvasContext.arc(ballPosX, ballPosY, ballSize*2, 0, Math.PI*2, true);
            canvasContext.fill();
            
            //canvasContext.fillRect(ballPosX, ballPosY, ballSize, ballSize);
        }
        
        function moveBall() {
            if(running){
                if((ballPosY+(ballSize*2))>=canvas.height){
                    ballDirY = -ballDirY;
                }
                if((ballPosX+(ballSize*2)+paddleWidth)>=canvas.width){
                    ballDirX = -ballDirX;
                    
                    if(ballPosY < paddle2PosY || ballPosY > (paddle2PosY+paddleHeight)){
                        ballReset();
                    }
                }
                if(ballPosX-(ballSize*2)-paddleWidth<=0){
                    ballDirX = -ballDirX;
                    
                    if(ballPosY < paddle1PosY || ballPosY > (paddle1PosY+paddleHeight)){
                        ballReset();
                        console.log("dick");
                    }
                }
                if(ballPosY-(ballSize*2)<=0){
                    ballDirY = -ballDirY;
                }

                ballPosX = ballPosX + ballDirX;
                ballPosY = ballPosY + ballDirY;
            }
        }
    </script>
</html>